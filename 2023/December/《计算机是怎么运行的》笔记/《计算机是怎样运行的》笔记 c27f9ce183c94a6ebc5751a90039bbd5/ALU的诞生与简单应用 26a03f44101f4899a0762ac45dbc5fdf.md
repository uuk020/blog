# ALU的诞生与简单应用

任意时刻的输出仅仅取决于该时刻的输入，与电路原来的输出无关（当然，当输入改变时，会经过一段传输延迟时间后，输出才会改变），我们称这种类型的电路为`组合电路`

在设计完组合电路的结构之后，我们一般都把组合电路看成是一个黑盒子，只露出输入和输出的导线

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled.png)

如图所示，图中的组合电路接受`n`个输入信号，产生`m`个输出信号。输出信号和输入信号的逻辑关系可以用下边的一组逻辑函数表示

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%201.png)

### 按位与运算

假设`A`代表n位二进制数`An-1An-2...A₂A₁A₀`、`B`代表n位二进制数`Bn-1Bn-2...B₂B₁B₀`。我们想让`A`和`B`做按位与运算，其实就是为`An-1`和`Bn-1`做与运算得到结果`Yn-1`、`An-2`和`Bn-2`做与运算得到结果`Yn-2`、...、`A₂`和`B₂`做与运算得到结果`Y₂`、`A₁`和`B₁`做与运算得到结果`Y₁`、`A₀`和`B₀`做与运算得到结果`Y₀`，最后将每个位进行与运算的结果拼接为`Yn-1Yn-2...Y₂Y₁Y₀`就是最终的运算结果

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%202.png)

`按位与`也是一种运算类型，我们使用`&`表示按位与运算的运算符号

### 按位或运算

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%203.png)

上图来表示两个n位二进制数`A`、`B`进行按位或运算，得到结果`Y`的过程（`Y`也是一个n位二进制数）。我们使用`|`表示按位或运算的运算符号

### 数据选择器

有时候我们会有从多个输入信号中选出一个作为输出信号的需求，比方现在要从`A₀`、`B₀`两个输入信号中选出一个作为输出信号`Y₀`

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%204.png)

那么:

- 当开关1闭合，开关2断开时，Y₀ = A₀，如下图所示
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%205.png)
    
- 当开关1断开，开关2闭合时，Y₀ = B₀，如下图所示
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%206.png)
    

使用之前介绍过的`传输门`作为电控开关来替代一下机械开关。我们使用`TG1`来替代原先的`开关1`，`TG2`来替代原先的`开关2`（TG是Transmission Gate的缩写）。由于`开关1`和`开关2`必须有且仅有一个闭合，另一个断开，所以两个传输门的控制信号必须得相反

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%207.png)

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%208.png)

- 当S₀=0时，TG1导通，TG2截止，此时Y₀ = A₀。
- 当S₀=1时，TG1截止，TG2导通，此时Y₀ = B₀。

由于S₀是用来控制Y₀到底是与A₀相同还是与B₀相同的，所以S₀也被称作`控制信号`，也可以被称作`数据选择信号`

上边的图还是太复杂，我们需要画一个简化的示意图

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%209.png)

图中的设备被称作`数据选择器`，简称选择器，或者也可以叫做多路开关、复用器等。由于上图所示的数据选择器完成了从两个输入信号里选择一个作为输出信号的功能，所以更准确地来讲，它应该被称为`2-1选择器`

- 当S₀=0，Y₀=A₀
- 当S₀=1，Y₀=B₀

仅仅能制作从两个信号中选择一个作为输出的`2-1选择器`，也可以制作从两组信号中选择一组作为输出的`2-1选择器`。比方说我们现在有两组输入信号：`An-1An-2...A₂A₁A₀`和`Bn-1Bn-2...B₂B₁B₀`，我们想从中选择一组作为输出`Yn-1Yn-2...Y₂Y₁Y₀`

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2010.png)

- 当S₀=0时，`Yn-1Yn-2...Y₂Y₁Y₀`的值和`An-1An-2...A₂A₁A₀`相同；
- 当S₀=1，`Yn-1Yn-2...Y₂Y₁Y₀`的值和`Bn-1Bn-2...B₂B₁B₀`相同

通过一个控制信号`S₀`可以制作出`2-1选择器`，如果我们增加一个控制信号`S₁`，也就是两个控制信号`S₀`和`S₁`就可以制造出一个`4-1选择器`，也就是从4组信号中选择一组来作为输出

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2011.png)

- 当`S₁=0, S₀=0`时，`Y=A`
- 当`S₁=0, S₀=1`时，`Y=B`
- 当`S₁=1, S₀=0`时，`Y=C`
- 当`S₁=1, S₀=1`时，`Y=D`

### ALU

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2012.png)

其中`A`、`B`分别表示两组输入信号（每组中包含n个信号），`S₁`和`S₀`作为`4-1`复用器的控制信号，并且`S₀`还作为`n位加法器`的`Cin`信号，决定着`n位加法器`是执行加法运算还是减法运算，`Y`表示一组输出信号（也包含n信号）。`Y`的值取决于`S₁`和`S₀`的值

- 当`S₁=0, S₀=0`时，`n位加法器`的`Cin`输入为0，表示执行加法操作，并且`4-1`复用器输出的是`n位加法器`的输出，也就是此时`Y`的值相当于`A + B`的值
- 当`S₁=0, S₀=1`时，`n位加法器`的`Cin`输入为1，表示执行减法操作，并且`4-1`复用器输出的是`n位加法器`的输出，也就是此时`Y`的值相当于`A - B`的值
- 当`S₁=1, S₀=0`时，`4-1`复用器输出的是`按位与`电路结构的输出，也就是此时`Y`的值相当于`A & B`的值
- 当`S₁=1, S₀=1`时，`4-1`复用器输出的是`按位或`电路结构的输出，也就是此时`Y`的值相当于`A | B`的值

对于同样的输入`A`和`B`，随着我们调节控制信号`S₁`和`S₀`的值，最终的输出`Y`也跟着改变，代表着`A`和`B`之间不同的运算结果。加法和减法属于算术运算，按位与和按位或属于逻辑运算，我们把这种用来对输入信号做算数或者逻辑运算的电路结构称之为`算术逻辑单元`，英文名：`Arithmetic/Logical Unit`，简称`ALU`

**制作简易输入/输出设备**

对于给定的两组输入信号A和B来说，我们只需要通过调节控制信号，就可以针对A和B做不同的运算, 

用 ALU 计算下面例子

```bash
74 + 29 + 32 + 20
```

- 怎样产生ALU的输入信号
    
    “互补开关信号发送设备”，它的电路图如下所示: 
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2013.png)
    
    当开关1闭合、开关2断开时，A点的信号就是逻辑1；当开关1断开、开关2闭合时，A点的信号就是逻辑0。其实我们也可以使用一个单刀双掷开关来替代图中的开关1和开关2。如图所示：
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2014.png)
    
    当我们想输出逻辑1的时候，就把开关向上闭合；当我们想输出逻辑0的时候，就把开关向下闭合
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2015.png)
    
    为了美观一点，我们可以使用下边将单刀双掷开关做成一个按钮的样子。按钮向上按，将会输出逻辑1，按钮向下按，将会输出逻辑0
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2016.png)
    
    现在我们就可以通过手动调节按钮来生成逻辑1或者逻辑0了。我们也可以使用多个按钮来生成更多个信号，比方说我们使用4个按钮就可以生成4个信号
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2017.png)
    
    这个设备生成的电压信号可以作为ALU的输入信号，我们也把它称作`输入设备`
    。每个信号都可以代表一个二进制位，我们刚刚制作的这个输入设备可以产生4个信号，所以该设备也可以被称为`4位输入设备`
    
- 怎么知道ALU的输出信号是什么
    
    当两组输入信号`A`、`B`经过`ALU`之后会得到一组输出信号`Y`，我们也不能像中医把脉那样去摸某根输出导线上的电压是几伏，所以需要一个输出设备来向我们人类展示一下这些输出信号到底是高电压还是低电压。我们当然可以使用电压表来测量每一个输出信号的电压，不过考虑到信号只有逻辑0和逻辑1两种类型，也就是高电压信号和低电压信号两种类型，我们使用灯泡来测试输出信号更简洁一点
    
    - 当输出信号是低电压信号时，灯泡不亮
    - 当输出信号是高电压信号时，灯泡发光
    
    ![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2018.png)
    
    这样我们可以将`ALU`的每个输出信号都作为一个灯泡的输入信号，灯泡不亮就说明`ALU`
    的输出信号为低电压，也就是`逻辑0`；灯泡发光就说明`ALU`的输出信号为`高电压`，也就是`逻辑1`
    。这里的灯泡就是简易的`输出设备`
    

因为要累加的那些数都比较小，8位无符号数已经足够表示它们本身以及它们的加和结果，所以我们可以采用两个`8位输入设备`来为`ALU`产生输入信号，1个`8位输出设备`来解释`ALU`的输出信号。由于我们之前设计的`ALU`只包含2个控制信号，所以也就可以使用`2位输入设备`来生成控制信号，我们画个图展示一下

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2019.png)

### 手动累加

- 由于刚刚制作的输入设备不太高级，我们只能先手动的将十进制数转换为二进制数
    
    ```bash
    74₁₀:  01001010₂
    29₁₀:  00011101₂
    32₁₀:  00100000₂
    20₁₀:  00010100₂
    ```
    
- 将`ALU`的控制信号调节成`S₁=0, S₀=0`，那么此时`ALU`就相当于一个加法器
- 在`1号输入设备`上通过按动按钮生成`01001010₂`（74₁₀）对应的信号，在`2号输入设备`上通过按动按钮生成`00011101₂`（29₁₀）对应的信号，然后在ALU的输出设备上观测到结果是：`01100111₂`（103₁₀），这个`01100111₂`是累加过程中的一个中间结果，我们需要先将这个`01100111₂`写到纸上以备下一步骤使用
    
    ```bash
    01001010₂（74₁₀） + 00011101₂（29₁₀） = 01100111₂（103₁₀）
    ```
    
- 在`1号输入设备`上通过按动按钮生成`01100111₂`（103₁₀，上一步骤中计算得到的中间结果）对应的信号，然后在`2号输入设备`上通过按动按钮生成`00100000₂`（32₁₀）对应的信号，然后在ALU的输出设备上观测到结果是：`10000111₂`（135₁₀），它也是一个中间结果，将它写到纸上以备下一步骤使用
    
    ```bash
    01100111₂（103₁₀） + 00100000₂（32₁₀） = 10000111₂（135₁₀）
    ```
    
- 同理，计算上一步骤中得到的中间结果`10000111₂`（135₁₀）与`00010100₂`（20₁₀）的和为`10011011₂`（155₁₀）
    
    ```bash
    10000111₂（135₁₀） + 00010100₂（20₁₀） = 10011011₂（155₁₀）
    ```
    

**使用多个硬件设备进行改进**

我们得把每一步骤中产生的结果先记到纸上，然后到下一个步骤中再使用输入设备为其产生对应的信号。其实如果使用多个输入设备和`ALU`的话，可以将这个环节省略掉，我们重新画一下电路图

![Untitled](ALU%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%2026a03f44101f4899a0762ac45dbc5fdf/Untitled%2020.png)

**缺点: 所需硬件过多**